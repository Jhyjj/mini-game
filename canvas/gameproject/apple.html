<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div id="start">
        <div>
            <h1>ê°•ì¥ë¯¸ë‹ˆê²Œì„ì²œêµ­</h1>
            <p>ê²Œì„ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="likebtn" id="gamebtn">YES</div>
            <div id="select">
                <div id="maze">ê°•ì¥ë¯¸ë¡œ</div>
                <div id="jumpgame">ê°•ì¥ ì‚¶ì˜ì²´í—˜</div>
                <div id="crush">ê°•ì¥ ë²½ê¹¨ê¸°</div>
                <div id="brain">ê°•ì¥ ê¸°ì–µë ¥ê²Œì„</div>
            </div>
            <div id="nogame">
                ê²Œì„ ìˆ˜ë¦¬ì¤‘...<br/>
                ë‹¤ë¥¸ ê²Œì„ì„ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br/>
                <button onclick="back()">YES</button>
            </div>
        </div>
    </div>
    <div id="game">
    <h1>ì‚¶ì˜ ì²´í—˜ - ì‚¬ê³¼ë†ì¥</h1>
    <div id="score">
        <span>ğŸìˆ˜í™•ëŸ‰:</span>
        <p onclick="gameStart()">ê²Œì„ì‹œì‘: clickâ£</p>
        <div id="timer">
            <div></div>
        </div>
    </div>
    <canvas></canvas>
    <div id="result">
        <p>ì¼ë‚¨ì´ê°€ ì‚¬ê³¼ë¥¼ ê°œ ë•„ìŠµë‹ˆë‹¤.</p>
        <div class="likebtn" onclick="restart()">ë‹¤ì‹œí•˜ê¸°</div>
        <!-- <div class="likebtn" onclick="">ê·¸ë§Œí•˜ê¸°</div> -->
    </div>
    </div>
   

    <script>
        let startPage = document.querySelector('#start');
        let startBtn = document.querySelector('#gamebtn');
        let select = document.querySelector('#select');
        let gameBtn  = document.querySelector('#jumpgame');
        let timerdiv = document.querySelector('#timer');
        let timerdiv2 = document.querySelector('#timer div')
        let timer = 60;
        let appleq = 0;
        let score = document.querySelector('#score span');
        let maze = document.querySelector('#maze');
        let canvas = document.querySelector('canvas');
        let ctx = canvas.getContext('2d');
        canvas.width = 600;
        canvas.height = 600;
        let jump = false;
        let jumptimer=0;
        let direction;
        let animation;
        let dogImg = new Image();
        dogImg.src = "/img/dog.png";

        let appleaImg = new Image();
        appleaImg.src = "/img/apple.png";

        let arr = [];
        let brickCol=25;
        let brickRow=10;

        console.log(dogImg);
        let tik;


        
        //ì‹œì‘í™”ë©´ì—ì„œ ë²„íŠ¼ ëˆ„ë¥´ë©´ ê²Œì„ ì„ íƒì°½ ë‚˜ì˜¤ê¸°
        startBtn.addEventListener('click',function(){
            select.style.display ='flex';
            startBtn.style.display='none';
            document.querySelector('#start div p').innerHTML="ê²Œì„ì„ ì„ íƒí•˜ì„¸ìš”";
        })

        //ê²Œì„ì„ íƒí•˜ë©´ ì‹œì‘í™”ë©´ ì•ˆë³´ì´ê²Œ, ê²Œì„í™”ë©´ ë³´ì´ê²Œ í•˜ê¸°
        gameBtn.addEventListener('click',function(){
            startPage.style.display='none';
            document.querySelector('#game').style.display="block";
        })
        
        //ì•ˆë˜ëŠ” ê²Œì„ ëˆ„ë¥´ë©´ ì•ˆëœë‹¤ëŠ” ì°½ ë„ìš°ê¸°
        maze.addEventListener('click', function(){
            document.querySelector('#nogame').style.display='block';
        })

        //ê²Œì„ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function back(){
            document.querySelector('#nogame').style.display='none';
        }



        //ê²Œì„ ì‹œì‘í•˜ë©´ ì¼ë‚¨ì´ ê·¸ë¦¬ê³ , í‚¤ì´ë²¤íŠ¸ í™œì„±í™”& íƒ€ì´ë¨¸ë°” í™œì„±í™”
        function gameStart(){
            ilnam.draw();
            window.addEventListener('keydown',function(e){
                direction = e.code;
                //ë°©í–¥í‚¤ ì¢Œìš°/ìŠ¤í˜ì´ìŠ¤í‚¤ë¡œë§Œ ì¼ë‚¨ì´ ì›€ì§ì´ëŠ” í•¨ìˆ˜ ì‹¤í–‰
                if(direction=='ArrowRight'||direction=='ArrowLeft'||direction=='Space'){
                moveIlnam();}
            })
            arr.forEach(blk=>blk.draw());
            document.querySelector('#score p').innerHTML="ë‚¨ì€ ì‹œê°„"
            tik = setInterval(()=>{
                timer--;
                timerdiv2.style.width = (timer*2) + "px";
                if(timer===45){
                    document.querySelector('#game').style.backgroundImage = 'linear-gradient(-225deg, #20E2D7 0%, #F9FEA5 100%)';}
                if(timer===30){
                    document.querySelector('#game').style.backgroundImage = 'linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%)';}
                if(timer===15){
                    document.querySelector('#game').style.backgroundImage = 'linear-gradient(to top, #48c6ef 0%, #6f86d6 100%)';}
                if(timer===1){
                    document.querySelector('#game').style.backgroundImage = 'linear-gradient(to top, #1e3c72 0%, #1e3c72 1%, #2a5298 100%)'}
                if(timer<=0){ gameend();}
            },1000);
        }


        //ê²Œì„ ì¢…ë£Œ í•¨ìˆ˜
        function gameend(){
                document.querySelector('#result').style.display="flex";
                document.querySelector('#result p').innerHTML=`ì¼ë‚¨ì´ê°€ ${appleq}ê°œì˜ ì‚¬ê³¼ë¥¼ ìˆ˜í™•í–ˆìŠµë‹ˆë‹¤.`;
                clearInterval(tik);
        }


        //ì¼ë‚¨ì´ ë§Œë“¤ê¸°
        let ilnam = {
            x: 50,
            y: 550,
            width:50,
            height:50,
            draw(){
                ctx.drawImage(dogImg,this.x,this.y,this.width,this.height);
            }
        }

        //ì¼ë‚¨ì´ ì›€ì§ì´ëŠ” í•¨ìˆ˜
        function moveIlnam(){
            ctx.clearRect(ilnam.x,ilnam.y,ilnam.width,ilnam.height);
            if(timer<=0) return;
            console.log(`ì‹œê°„ì€${timer}`);
            if(direction==='ArrowRight'){
                if(ilnam.x+ilnam.width===600){
                    ilnam.draw();
                }else{
                ilnam.x+=ilnam.width;
                ilnam.draw();}
            }else if(direction==='ArrowLeft'){
                if(ilnam.x+ilnam.width===0+ilnam.width){
                    ilnam.draw();
                }else{
                ilnam.x-=ilnam.width;
                ilnam.draw();}
            }else{
                if(direction==='Space'){
                    jump=true;
                    jumpIlnam();
                    }
                }
            }

        //ì¼ë‚¨ì´ ì í”„í•˜ëŠ” í•¨ìˆ˜
        //ìŠ¤í˜ì´ìŠ¤í‚¤ë¥¼ ëˆŒë €ì„ë•Œ yê°’ì´ ì¦ê°€.
        //yê°’ì´ 0ì´ ë˜ë©´ ë‹¤ì‹œ ë°”ë‹¥ìœ¼ë¡œ ë‚´ë ¤ê°.
        //ë˜ëŠ” ì‚¬ê³¼ì— ë‹¿ìœ¼ë©´ ë°”ë‹¥ìœ¼ë¡œ ë‚´ë ¤ê°.
        function jumpIlnam(){
            animation = requestAnimationFrame(jumpIlnam);
            ctx.clearRect(ilnam.x,ilnam.y,ilnam.width,ilnam.height);
            arr.forEach((apple,index,arr)=>{
                crushCheck(ilnam,apple);
            })
            
            if(jump){
                ilnam.y--;
                jumptimer++;
                console.log(jumptimer);
            }
            else{
                if(ilnam.y<550) ilnam.y++; jumptimer=0;
            }
            
            //ì¼ë‚¨ì´ê°€ ì‚¬ê³¼ë¥¼ ë”°ë©´ ë‹¤ì‹œ ë‚´ë ¤ì˜¤ê¸°
            if(jumptimer > 510){
                jump=false;
                jumptimer=0;
            }
            ilnam.draw();
            
        }
        

        //ë¸”ëŸ­ ì„¤ì •

        class Blocks{
            constructor(){
                this.x = Math.floor(Math.random()*10)*50;
                this.y = Math.floor(Math.random()*10)*50;
                this.width = 50;
                this.height = 50;
                this.isCrush = false;
            }
            draw(){
                // appleaImg.addEventListener('load',()=>{
                    ctx.drawImage(appleaImg,this.x,this.y,this.width,this.height);
                    ctx.clearRect(0,0,150,150);
                    ctx.clearRect(450,0,150,100);
                    ctx.clearRect(0,150,100,50);  
                // })
            }
        }

        //ì—¬ê¸°ì„œë¶€í„° ë¸”ëŸ­ë§Œë“¤ê¸°....ğŸ˜­
        function MakeMaze(){
            for(let i=1;i<60;i++){
            let block = new Blocks;
            //ì¢Œí‘œê°€ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ì‚¬ê³¼ë§Œ ë°°ì—´ì— ë„£ê¸°~!
            let sameblock = arr.findIndex(blk=>blk.x===block.x&&blk.y===block.y)
            if(sameblock=-1){
            arr.push(block);
            console.log('ì¤‘ë³µëœ ì¢Œí‘œê°€ ì—†ìŠµë‹ˆë‹¤.')
            }else{i--;}
        }}
        MakeMaze();


        //ì¶©ëŒì´ë²¤íŠ¸
        function crushCheck(user,item){
            if(user.x===item.x&&user.y===item.y){
                item.isCrush=true;
                appleq++;
                console.log(`ğŸì¼ë‚¨ì´ê°€ ì‚¬ê³¼ë¥¼ ${appleq}ê°œ ë•„ìŠµë‹ˆë‹¤ğŸ`);
                score.innerHTML=`ğŸìˆ˜í™•ëŸ‰: ${appleq}`;
                jump=false;
                user.y++;
                jumptimer=0;
                //ë¶€ë”ªíŒ ì‚¬ê³¼ëŠ” ë°°ì—´ì—ì„œ ì‚­ì œí•´ì£¼ê¸°ğŸ”¥
                arr.splice(arr.findIndex((apple)=>apple.isCrush===true),1);
                if(ilnam.y===550){
                cancelAnimationFrame(animation)  }
            }
            
        }

        // ì¬ì‹œì‘ ë‹¤ ì´ˆê¸°í™” ì‹œí‚¤ê¸°~~~
        function restart(){
                document.querySelector('#result').style.display="none";
                document.querySelector('#game').style.backgroundImage = 'linear-gradient(-225deg, #20E2D7 0%, #F9FEA5 100%)';
                timer=60;
                appleq=0;
                score.innerHTML=`ğŸìˆ˜í™•ëŸ‰: ${appleq}`;
                cancelAnimationFrame(animation);
                ctx.clearRect(0,0,500,500);
                arr=[];
                console.log(arr);
                MakeMaze();
                console.log(arr);
                arr.forEach(blk=>blk.draw());
                jumptimer=0;
                jump=false;
                gameStart();
                
            }


   

    </script>
</body>
</html>